<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Letreiro V2</title>
    <style>
        body {
            margin: 0; padding: 0; background-color: #000; overflow: hidden;
            display: flex; align-items: center; height: 100vh;
            font-family: 'Courier New', Courier, monospace;
        }
        .marquee-container {
            white-space: nowrap; overflow: hidden; position: absolute; width: 100%;
        }
        .marquee-text {
            display: inline-block;
            font-size: 25vw;
            font-weight: bold; color: #0f0; text-shadow: 0 0 10px #0f0;
            padding-left: 100%;
            /* A animação padrão começa com 15s, mas será alterada via JS */
            animation: scroll-left 15s linear infinite;
            transform: translate3d(0, 0, 0);
        }
        @keyframes scroll-left {
            0% { transform: translate3d(0, 0, 0); }
            100% { transform: translate3d(-100%, 0, 0); }
        }
        #debug-console {
            position: absolute; top: 0; left: 0; width: 100%; 
            background: rgba(50,0,0,0.8); color: #fff; font-size: 14px; 
            z-index: 9999; display: none; padding: 10px;
        }
    </style>
</head>
<body>
    <div id="debug-console"></div>
    
    <div class="marquee-container">
        <div class="marquee-text" id="texto">
            INICIANDO...
        </div>
    </div>

    <script>
        // --- CONFIGURAÇÃO ---
        var BUCKET_ID = "Nx4eX6XbVusH98XQ86tkpg"; 
        var KEY = "mensagem";
        var URL_BASE = "https://kvdb.io/" + BUCKET_ID + "/" + KEY;

        var textoAtual = "";
        var velocidadeAtual = "";

        function logError(msg) {
            var debugEl = document.getElementById('debug-console');
            debugEl.style.display = 'block';
            debugEl.innerHTML += "ERRO: " + msg + "<br>";
        }

        window.onerror = function(message) { logError(message); };

        function verificarDados() {
            var urlComCacheBuster = URL_BASE + "?t=" + new Date().getTime();
            
            fetch(urlComCacheBuster)
                .then(function(response) { return response.text(); })
                .then(function(dadosRaw) {
                    // Tenta ler como JSON (formato novo) ou Texto (formato antigo)
                    var dados;
                    try {
                        dados = JSON.parse(dadosRaw);
                    } catch (e) {
                        // Se falhar o JSON, assume que é texto puro (compatibilidade)
                        dados = { texto: dadosRaw, velocidade: 15 };
                    }

                    // 1. Atualiza o Texto se mudou
                    if (dados.texto && dados.texto !== textoAtual) {
                        textoAtual = dados.texto;
                        document.getElementById('texto').innerText = textoAtual;
                    }

                    // 2. Atualiza a Velocidade se mudou
                    // Convertemos para string para comparar
                    if (dados.velocidade && String(dados.velocidade) !== String(velocidadeAtual)) {
                        velocidadeAtual = dados.velocidade;
                        var el = document.getElementById('texto');
                        // Altera o CSS direto no elemento
                        el.style.animationDuration = velocidadeAtual + 's';
                    }
                })
                .catch(function(error) {
                    console.log("Erro silencioso de rede: " + error.message);
                });
        }

        // Verifica a cada 5 segundos (Isso é a frequência de checagem, não a velocidade do texto!)
        try {
            verificarDados();
            setInterval(verificarDados, 5000);
        } catch (e) {
            logError("Falha crítica: " + e.message);
        }
    </script>
</body>
</html>