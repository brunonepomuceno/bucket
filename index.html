<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">

    <title>Parab√©ns Juliana</title>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        body {
            margin: 0;
            padding: 0;
            background-color: #000;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100vh;
            font-family: 'Courier New', Courier, monospace;
        }

        canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99;
        }

        #player {
            position: absolute;
            top: -9999px;
            left: -9999px;
        }

        #gif-surpresa {
            position: absolute;
            z-index: 50;
            display: none;
            max-width: 80%;
            max-height: 80vh;
            border-radius: 15px;
            box-shadow: 0 0 50px rgba(0, 255, 0, 0.5);
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 99999;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #0f0;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            flex-direction: column;
            text-align: center;
        }

        #botao-secreto {
            position: fixed;
            bottom: 0;
            right: 0;
            width: 80px;
            height: 80px;
            z-index: 999999;
            cursor: pointer;
            background-color: rgba(255, 255, 255, 0.0);
        }

        .marquee-container {
            white-space: nowrap;
            overflow: hidden;
            position: absolute;
            width: 100%;
            z-index: 60;
        }

        .marquee-text {
            display: inline-block;
            font-size: 25vw;
            font-weight: bold;
            color: #0f0;
            text-shadow: 0 0 10px #0f0;
            padding-left: 100%;
            animation: scroll-left 15s linear infinite;
            transform: translate3d(0, 0, 0);
        }

        @keyframes scroll-left {
            0% {
                transform: translate3d(0, 0, 0);
            }

            100% {
                transform: translate3d(-100%, 0, 0);
            }
        }
    </style>
</head>

<body>
    <div id="overlay" onclick="iniciarSistema()">
        <div>TOQUE PARA INICIAR<br><span style="font-size:12px; color:#666">(Necess√°rio para liberar o √°udio)</span>
        </div>
    </div>

    <a id="botao-secreto" href="https://brunonepomuceno.github.io/bucket/admin" title="Ir para Admin"></a>

    <div id="player"></div>
    <img id="gif-surpresa" src="juliana.gif" alt="Surpresa">

    <div class="marquee-container">
        <div class="marquee-text" id="texto">
            Parab√©ns Juliana üéâ üéÇ ü•≥ ü•Ç üçæ üéä üéà üéÅ üíñ üíù
        </div>
    </div>

    <script>
        // --- CONFIGURA√á√ÉO ---
        var BUCKET_ID = "Nx4eX6XbVusH98XQ86tkpg";
        var KEY = "mensagem";
        var URL_BASE = "https://kvdb.io/" + BUCKET_ID + "/" + KEY;

        // Vari√°veis de Estado
        var textoPadrao = "Parab√©ns Juliana üéâ üéÇ ü•≥ ü•Ç üçæ üéä üéà üéÅ üíñ üíù";
        var textoAtual = textoPadrao;
        var velocidadeAtual = "";

        // Estado da M√∫sica e Confete
        var currentVideoId = "SRVxRUJxITY"; // ID padr√£o (Overmono)
        var lastConfeteToken = 0; // Para controlar o bot√£o de confete manual

        var player;
        var audioLiberado = false;
        var musicaTocando = false;

        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '1', width: '1', videoId: currentVideoId,
                playerVars: { 'playsinline': 1, 'controls': 0, 'loop': 1 }
            });
        }

        function iniciarSistema() {
            document.getElementById('overlay').style.display = 'none';
            audioLiberado = true;
            if (player && player.playVideo) {
                player.mute(); player.playVideo();
                setTimeout(function () { player.pauseVideo(); player.unMute(); }, 1000);
            }
            verificarDados();
        }

        function dispararConfete() {
            if (typeof confetti === 'undefined') return;
            var duration = 3 * 1000; var end = Date.now() + duration;
            (function frame() {
                confetti({ particleCount: 5, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#f00', '#0f0', '#00f'] });
                confetti({ particleCount: 5, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#f00', '#0f0', '#00f'] });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        function verificarDados() {
            var urlComCacheBuster = URL_BASE + "?t=" + new Date().getTime();

            fetch(urlComCacheBuster, { cache: "no-store" })
                .then(function (r) { return r.text(); })
                .then(function (dadosRaw) {
                    var dados;
                    try { dados = JSON.parse(dadosRaw); }
                    catch (e) { dados = { texto: dadosRaw, velocidade: 15 }; }

                    // 1. VERIFICA SE H√Å MUDAN√áA DE VIDEO
                    if (dados.videoId && dados.videoId !== currentVideoId) {
                        currentVideoId = dados.videoId;
                        if (player && player.loadVideoById) {
                            console.log("Mudando m√∫sica para: " + currentVideoId);
                            // Carrega o v√≠deo mas deixa pausado (s√≥ toca no gatilho 'te amo')
                            player.cueVideoById(currentVideoId);
                            // Se j√° estiver tocando (modo festa ativo), d√° play direto
                            if (musicaTocando) player.playVideo();
                        }
                    }

                    // 2. BOT√ÉO MANUAL DE CONFETE
                    // Se o token que veio do banco for maior que o ultimo que vimos, dispara!
                    if (dados.confeteToken && dados.confeteToken > lastConfeteToken) {
                        lastConfeteToken = dados.confeteToken;
                        console.log("Comando manual de confete recebido!");
                        dispararConfete();
                    }

                    // 3. ATUALIZA√á√ÉO DE TEXTO E L√ìGICA 'TE AMO'
                    var novoTexto = dados.texto ? dados.texto : textoPadrao;

                    if (novoTexto !== textoAtual) {
                        textoAtual = novoTexto;
                        document.getElementById('texto').innerText = textoAtual;

                        var tLimpo = textoAtual.toLowerCase().replace(/\s/g, '');
                        var gifEl = document.getElementById('gif-surpresa');

                        if (tLimpo === "teamo") {
                            console.log("Modo Te Amo: ATIVADO");
                            dispararConfete(); // Confete do modo autom√°tico
                            gifEl.style.display = "block";

                            if (audioLiberado && player && player.playVideo && !musicaTocando) {
                                // Se for o Overmono, pula pra 14s. Se for outro, come√ßa do 0.
                                var seekTo = (currentVideoId === "SRVxRUJxITY") ? 14 : 0;
                                player.seekTo(seekTo);
                                player.setVolume(100);
                                player.playVideo();
                                musicaTocando = true;
                            }
                        } else {
                            console.log("Modo Te Amo: DESATIVADO");
                            gifEl.style.display = "none";

                            if (musicaTocando && player && player.pauseVideo) {
                                player.pauseVideo();
                                musicaTocando = false;
                            }
                        }
                    }

                    // 4. VELOCIDADE
                    if (dados.velocidade && String(dados.velocidade) !== String(velocidadeAtual)) {
                        velocidadeAtual = dados.velocidade;
                        document.getElementById('texto').style.animationDuration = velocidadeAtual + 's';
                    }
                })
                .catch(function (e) { console.log("Erro de conex√£o: " + e); });
        }

        setInterval(verificarDados, 5000);
    </script>
</body>

</html>